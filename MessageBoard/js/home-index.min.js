var homeIndexModule=angular.module("homeIndex",["ngRoute"]),topicsController;homeIndexModule.config(["$routeProvider",function(n){n.when("/",{controller:"topicsController",templateUrl:"templates/topicsView.html"});n.when("/newmessage",{controller:"newTopicController",templateUrl:"templates/newTopicView.html"});n.when("/message/:id",{controller:"singleTopicController",templateUrl:"templates/singleTopicView.html"});n.otherwise({redirectTo:"/"})}]);homeIndexModule.factory("dataService",["$http","$q",function(n,t){function e(n){var t=null;return $.each(i,function(i,r){if(r.id==n)return t=r,!1}),t}var i=[],r=!1,u=function(){return r},h=function(){var n=t.defer(),u=breeze.EntityQuery,o=breeze.FilterQueryOp,s=breeze.Predicate,f=new breeze.EntityManager("http://localhost/Playground/MessageBoard/breeze/breeze"),e=u.from("Topics");return f.executeQuery(e).then(function(t){angular.copy(t.data,i);r=!0;n.resolve()}).fail(function(){n.reject("No topics loaded.")}),n.promise},f=function(){var u=t.defer();return n.get("api/v1/topics?includeReplies=true").then(function(n){angular.copy(n.data,i);r=!0;u.resolve()},function(){u.reject("No topics loaded.")}),u.promise},o=function(r){var u=t.defer();return n.post("api/v1/topics",r).then(function(n){var t=n.data;i.splice(0,0,t);u.resolve(t)},function(){u.reject("Failed to save new topic.")}),u.promise},s=function(n){var i=t.defer(),r;return u()?(r=e(n),r?i.resolve(r):i.reject("Can't find topic in previously loaded topics")):f().then(function(){var t=e(n);t?i.resolve(t):i.reject("Loaded all topics but can't find this one")},function(){i.reject("Failed to load topics")}),i.promise};return saveReply=function(i,r){var u=t.defer();return n.post("api/v1/topics/"+i.id+"/replies",r).then(function(n){i.replies==null&&(i.replies=[]);i.replies.push(n.data);u.resolve(n.data)},function(){u.reject("Failed to save reply")}),u.promise},{topics:i,getTopics:f,addTopic:o,isReady:u,getTopicById:s,saveReply:saveReply}}]);topicsController=["$scope","$http","dataService",function(n,t,i){n.data=i;n.isBusy=!1;i.isReady()||(n.isBusy=!0,i.getTopics().then(function(){},function(n){n==undefined?alert("Failed to load topics."):alert(n)}).then(function(){n.isBusy=!1}))}];homeIndexModule.controller("topicsController",topicsController);homeIndexModule.controller("newTopicController",["$scope","$http","$window","dataService",function(n,t,i,r){n.newTopic={};n.save=function(){r.addTopic(n.newTopic).then(function(){i.location="#/"},function(n){alert(n)})}}]);homeIndexModule.controller("singleTopicController",["$scope","$http","$window","dataService","$routeParams",function(n,t,i,r,u){n.topic=null;n.newReply={};r.getTopicById(u.id).then(function(t){n.topic=t},function(){i.location="#/"});n.addReply=function(){r.saveReply(n.topic,n.newReply).then(function(){n.newReply.body=""},function(n){alert(n)})}}]);
/*
//# sourceMappingURL=home-index.min.js.map
*/